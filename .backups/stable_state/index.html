<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cozy Focus Space</title>
    <link rel="stylesheet" href="style.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;700&family=JetBrains+Mono:wght@400;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        const savedAccent = localStorage.getItem('cozyAccent') || '#ff79c6';
        document.documentElement.style.setProperty('--accent', savedAccent);
        
        // Extract RGB for --accent-rgb
        const match = savedAccent.match(/\d+/g);
        if (match && match.length >= 3) {
            document.documentElement.style.setProperty('--accent-rgb', `${match[0]}, ${match[1]}, ${match[2]}`);
        } else if (savedAccent.startsWith('#')) {
            // Simple hex to rgb conversion
            const r = parseInt(savedAccent.slice(1, 3), 16);
            const g = parseInt(savedAccent.slice(3, 5), 16);
            const b = parseInt(savedAccent.slice(5, 7), 16);
            document.documentElement.style.setProperty('--accent-rgb', `${r}, ${g}, ${b}`);
        }
    </script>
</head>
<body>
    <div class="bg-overlay"></div>

    <!-- Top Left: Ambient Indicators -->
    <div id="ambient-indicators" class="corner-widget top-left">
        <i class="fas fa-cloud-rain" data-type="rain" title="Rain active"></i>
        <i class="fas fa-wind" data-type="wind" title="Wind active"></i>
        <i class="fas fa-mug-hot" data-type="cafe" title="Cafe active"></i>
        <i class="fas fa-fire" data-type="fire" title="Fire active"></i>
    </div>

    <!-- Top Right: Focus Visualizer -->
    <div id="focus-visualizer" class="corner-widget top-right">
        <div class="visualizer-ring"></div>
        <span class="visualizer-text">FOCUSING</span>
    </div>
    
    <main class="dashboard">
        <!-- Widget: Clock, Greeting, Weather -->
        <div class="widget-header">
            <div id="clock" class="clock">00:00</div>
            <h2 id="greeting" class="greeting">Good Morning</h2>
            <div class="date-weather-row">
                <div id="date" class="date">Loading date...</div>
            </div>
        </div>

        <!-- Column Left: History & Toys -->
        <div class="left-column">
            <!-- Widget: Focus History (Top) -->
            <div class="glass-panel history-panel">
                <div class="panel-header">
                    <h3>Focus History</h3>
                    <button id="view-toggle-btn" class="icon-btn-small" title="Toggle View"><i class="fas fa-chart-line"></i></button>
                </div>
                
                <!-- Calendar View -->
                <div id="calendar-view" class="history-view">
                    <div id="mini-calendar" class="mini-calendar"></div>
                    <button id="today-focus-btn" class="stats-btn">
                        <span id="today-focus">0m focused today</span>
                    </button>
                </div>

                <!-- Analysis View -->
                <div id="analysis-view" class="history-view">
                    <div class="analysis-header">
                        <button id="prev-day"><i class="fas fa-chevron-left"></i></button>
                        <span id="analysis-date">Today</span>
                        <button id="next-day"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div class="analysis-chart" id="focus-chart">
                        <!-- Bars injected by JS -->
                    </div>
                    <ul id="analysis-sessions" class="session-history"></ul>
                </div>
            </div>

            <!-- Widget: Focus Toys (Bottom) -->
            <div class="glass-panel toys-panel">
                <div class="panel-header">
                    <h3>Toys</h3>
                    <div class="widget-switcher">
                        <button id="toy-info-btn" class="icon-btn-small" title="Toy Info"><i class="fas fa-question-circle"></i></button>
                        <button class="switch-btn active" data-widget="mixer" title="Mixer"><i class="fas fa-sliders-h"></i></button>
                        <button class="switch-btn" data-widget="stars" title="Stars"><i class="fas fa-star"></i></button>
                        <button class="switch-btn" data-widget="pet" title="Pet"><i class="fas fa-robot"></i></button>
                        <button class="switch-btn" data-widget="pulse" title="Pulse"><i class="fas fa-wave-square"></i></button>
                    </div>
                </div>

                <div id="toy-drawer" class="toy-drawer">
                    <h4 id="toy-drawer-title">Focus Tree</h4>
                    <p id="toy-drawer-desc">Grow a tree by focusing for 25 minutes.</p>
                </div>

                <div class="widget-display">
                    <!-- Mixer Widget -->
                    <div id="widget-mixer" class="widget-content hidden">
                        <div class="mixer-container">
                            <div class="mixer-row">
                                <div class="mixer-icon-container" data-type="rain"><i class="fas fa-cloud-rain"></i></div>
                                <input type="range" class="mixer-slider" min="0" max="100" value="0">
                            </div>
                            <div class="mixer-row">
                                <div class="mixer-icon-container" data-type="wind"><i class="fas fa-wind"></i></div>
                                <input type="range" class="mixer-slider" min="0" max="100" value="0">
                            </div>
                            <div class="mixer-row">
                                <div class="mixer-icon-container" data-type="cafe"><i class="fas fa-mug-hot"></i></div>
                                <input type="range" class="mixer-slider" min="0" max="100" value="0">
                            </div>
                            <div class="mixer-row">
                                <div class="mixer-icon-container" data-type="fire"><i class="fas fa-fire"></i></div>
                                <input type="range" class="mixer-slider" min="0" max="100" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- Stars Widget -->
                    <div id="widget-stars" class="widget-content hidden">
                        <canvas id="stars-canvas"></canvas>
                        <div class="stars-actions">
                            <button id="shuffle-stars" class="widget-action-btn" title="Next Constellation"><i class="fas fa-random"></i></button>
                            <button id="stars-info-btn" class="widget-action-btn" title="Star Hierarchy"><i class="fas fa-info-circle"></i></button>
                        </div>
                    </div>

                    <!-- Pet Widget -->
                    <div id="widget-pet" class="widget-content hidden">
                        <div class="pet-container">
                            <div class="pet-character" id="pet-display"><i class="fas fa-robot"></i></div>
                            <p id="pet-status">Pet is resting...</p>
                        </div>
                    </div>

                    <!-- Pulse Widget -->
                    <div id="widget-pulse" class="widget-content hidden">
                        <div class="pulse-container"><div class="pulse-blob"></div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Widget: Focus Timer (Center) -->
        <div class="glass-panel timer-panel">
            <!-- Task Selection -->
            <div class="task-selector">
                <select id="focus-task-select">
                    <option value="">-- Select a Task --</option>
                    <option value="Just Focus">Just Focus</option>
                </select>
            </div>

            <div class="timer-display">
                <!-- Circular progress with dynamic colors and moving thumb -->
                <svg class="progress-ring" width="300" height="300">
                    <circle class="progress-ring__circle-bg" stroke="var(--accent)" stroke-width="10" fill="transparent" r="140" cx="150" cy="150"/>
                    <circle class="progress-ring__circle" stroke="rgba(0,0,0,0.5)" stroke-width="10" fill="transparent" r="140" cx="150" cy="150"/>
                    <circle class="progress-ring__thumb" r="6" fill="white" cx="150" cy="10" />
                </svg>
                <div class="time-container">
                    <div class="time" id="time" contenteditable="true" title="Click to edit minutes">25:00</div>
                    <div class="edit-hint">edit</div>
                </div>
            </div>

            <div class="timer-presets">
                <button class="preset-time" data-mins="15">15</button>
                <button class="preset-time" data-mins="25">25</button>
                <button class="preset-time" data-mins="45">45</button>
                <button class="preset-time" data-mins="60">60</button>
            </div>

            <div class="controls">
                <button id="toggle-sound" class="icon-btn" title="Toggle Brown Noise"><i class="fas fa-volume-mute"></i></button>
                <button id="start-btn" class="main-btn"><i class="fas fa-play"></i></button>
                <button id="reset-btn" class="icon-btn"><i class="fas fa-redo"></i></button>
            </div>
            <div class="status" id="timer-status">Ready to Focus</div>
        </div>

        <!-- Widget: To-Do List (Right) -->
        <div class="glass-panel todo-panel">
            <h3>Today's Tasks</h3>
            <div class="todo-input-group">
                <input type="text" id="todo-input" placeholder="Add a new task...">
                <button id="add-todo"><i class="fas fa-plus"></i></button>
            </div>
            <ul id="todo-list" class="todo-list">
                <!-- Items added here -->
            </ul>
        </div>
    </main>

    <!-- Widget: Quote (Bottom) -->
    <div class="quote-container">
        <p id="quote-text">"Loading inspiration..."</p>
        <span id="quote-author"></span>
        <button id="new-quote" title="New Quote"><i class="fas fa-sync-alt"></i></button>
    </div>

    <!-- Floating Action Buttons -->
    <div class="floating-actions">
        <button id="about-btn" class="action-btn" title="About Kozy">
            <span class="kozy-logo">K</span>
        </button>
        <a href="https://github.com/MizxGaming/Kozy" target="_blank" class="action-btn" title="GitHub Repository">
            <i class="fab fa-github"></i>
        </a>
        <button id="settings-btn" class="action-btn" title="Customize Theme">
            <i class="fas fa-cog"></i>
        </button>
    </div>

    <!-- Stars Hierarchy Window -->
    <div id="stars-hierarchy-window" class="modal hidden">
        <div class="modal-content stars-window-content">
            <button id="close-stars-drawer" class="close-modal">&times;</button>
            <div class="drawer-header">
                <h2>Star Hierarchy</h2>
            </div>
            <p class="modal-subtitle">1 star = 5 minutes of focus</p>
            <div id="stars-hierarchy-list" class="hierarchy-list">
                <!-- Dynamically populated -->
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div id="about-modal" class="modal hidden">
        <div class="modal-content about-content">
            <button id="close-about-modal" class="close-modal">&times;</button>
            <div class="about-header">
                <div class="kozy-logo large">K</div>
                <h2>About Kozy</h2>
                <p class="modal-subtitle">v1.0.0 "Stardust"</p>
            </div>
            <div class="about-body">
                <p>Kozy is a personalized focus dashboard designed to make productivity feel aesthetic and rewarding.</p>
                <p>Built with focus on minimalism and user experience, Kozy combines essential tools like a countdown timer and to-do list with "Toys" that visualize your progress in beautiful ways.</p>
                <div class="about-features">
                    <div class="feature-item"><i class="fas fa-star"></i> <span>Build constellations as you work</span></div>
                    <div class="feature-item"><i class="fas fa-robot"></i> <span>A digital companion for focus sessions</span></div>
                    <div class="feature-item"><i class="fas fa-sliders-h"></i> <span>Immersive ambient sound mixer</span></div>
                </div>
                <p class="about-footer">Created with ❤️ for focus seekers.</p>
            </div>
        </div>
    </div>

    <!-- Stars Legend Modal (Removed standard modal, now handled by drawer) -->

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content glass-panel">
            <div class="modal-header">
                <h3>Settings</h3>
                <button id="close-settings"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="settings-group">
                <h4>Personalize</h4>
                <div class="input-row">
                    <label>Name:</label>
                    <input type="text" id="user-name" placeholder="Your Name">
                </div>
            </div>

            <div class="wallpaper-section">
                <h4>Aesthetic (2D)</h4>
                <div class="presets">
                    <!-- Anime / 2D Presets -->
                    <button class="preset-btn" data-bg="https://images.wallpapersden.com/image/download/anime-girl-looking-at-sky-scenery_bWlma2uUmZqaraWkpJRmbmdlrWZlbWU.jpg" style="background-image: url('https://images.wallpapersden.com/image/download/anime-girl-looking-at-sky-scenery_bWlma2uUmZqaraWkpJRmbmdlrWZlbWU.jpg')"></button>
                    <button class="preset-btn" data-bg="https://c4.wallpaperflare.com/wallpaper/500/442/354/outrun-vaporwave-hd-wallpaper-preview.jpg" style="background-image: url('https://c4.wallpaperflare.com/wallpaper/500/442/354/outrun-vaporwave-hd-wallpaper-preview.jpg')"></button>
                    <button class="preset-btn" data-bg="https://images.wallpapersden.com/image/download/pixel-art-night-sky-scenery_bWxlZm6UmZqaraWkpJRmbmdlrWZlbWU.jpg" style="background-image: url('https://images.wallpapersden.com/image/download/pixel-art-night-sky-scenery_bWxlZm6UmZqaraWkpJRmbmdlrWZlbWU.jpg')"></button>
                    <button class="preset-btn" data-bg="https://images.wallpapersden.com/image/download/lofi-girl-original_bGZraWyUmZqaraWkpJRmbmdlrWZlbWU.jpg" style="background-image: url('https://images.wallpapersden.com/image/download/lofi-girl-original_bGZraWyUmZqaraWkpJRmbmdlrWZlbWU.jpg')"></button>
                </div>
            </div>

            <div class="upload-section">
                <h4>Custom Wallpaper</h4>
                <label for="bg-upload" class="upload-btn">
                    <i class="fas fa-upload"></i> Upload Image
                </label>
                <input type="file" id="bg-upload" accept="image/*" hidden>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>