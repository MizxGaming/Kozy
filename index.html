<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cozy Focus Space</title>
    <link rel="stylesheet" href="style.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;700&family=JetBrains+Mono:wght@400;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        // High-priority pre-render script with IndexedDB support
        (function() {
            const defaultBg = 'https://images.wallpapersden.com/image/download/anime-girl-looking-at-sky-scenery_bWlma2uUmZqaraWkpJRmbmdlrWZlbWU.jpg';
            const savedAccent = localStorage.getItem('cozyAccent');
            
            if (savedAccent) {
                document.documentElement.style.setProperty('--accent', savedAccent);
            }

            // Check IndexedDB for large custom images
            const request = indexedDB.open("CozyFocusDB", 1);
            request.onupgradeneeded = (e) => e.target.result.createObjectStore("settings");
            request.onsuccess = (e) => {
                const db = e.target.result;
                const tx = db.transaction("settings", "readonly");
                const store = tx.objectStore("settings");
                const getBg = store.get("customBg");
                getBg.onsuccess = () => {
                    const bg = getBg.result || localStorage.getItem('cozyBg') || defaultBg;
                    document.documentElement.style.setProperty('--current-bg', `url('${bg}')`);
                };
            };
            request.onerror = () => {
                const bg = localStorage.getItem('cozyBg') || defaultBg;
                document.documentElement.style.setProperty('--current-bg', `url('${bg}')`);
            };
        })();
    </script>
</head>
<body>
    <div class="bg-overlay"></div>
    
    <main class="dashboard">
        <!-- Widget: Clock, Greeting, Weather -->
        <div class="widget-header">
            <div id="clock" class="clock">00:00</div>
            <h2 id="greeting" class="greeting">Good Morning</h2>
            <div class="date-weather-row">
                <div id="date" class="date">Loading date...</div>
                <div id="weather" class="weather hidden">
                    <i class="fas fa-cloud-sun"></i> <span>--Â°C</span>
                </div>
            </div>
        </div>

        <!-- Column Left: History & Toys -->
        <div class="left-column">
            <!-- Widget: Focus History (Top) -->
            <div class="glass-panel history-panel">
                <div class="panel-header">
                    <h3>Focus History</h3>
                </div>
                <div id="mini-calendar" class="mini-calendar"></div>
                <div class="daily-stats">
                    <span id="today-focus">0m focused today</span>
                </div>
            </div>

            <!-- Widget: Focus Toys (Bottom) -->
            <div class="glass-panel toys-panel">
                <div class="panel-header">
                    <h3>Toys</h3>
                    <div class="widget-switcher">
                        <button class="switch-btn active" data-widget="tree" title="Tree"><i class="fas fa-seedling"></i></button>
                        <button class="switch-btn" data-widget="tape" title="Tape"><i class="fas fa-compact-disc"></i></button>
                        <button class="switch-btn" data-widget="mixer" title="Mixer"><i class="fas fa-sliders-h"></i></button>
                        <button class="switch-btn" data-widget="stars" title="Stars"><i class="fas fa-star"></i></button>
                        <button class="switch-btn" data-widget="pet" title="Pet"><i class="fas fa-robot"></i></button>
                        <button class="switch-btn" data-widget="pulse" title="Pulse"><i class="fas fa-wave-square"></i></button>
                    </div>
                </div>

                <div id="widget-display" class="widget-display">
                    <!-- Tree Widget -->
                    <div id="widget-tree" class="widget-content">
                        <div class="tree-container">
                            <div class="tree-stage" id="tree-display"></div>
                            <p class="toy-label">Focus Tree</p>
                        </div>
                    </div>

                    <!-- Tape Widget -->
                    <div id="widget-tape" class="widget-content">
                        <div class="tape-container">
                            <div class="cassette">
                                <div class="reel left-reel"></div>
                                <div class="reel right-reel"></div>
                                <div class="label" id="tape-label">SPACE FOCUS</div>
                            </div>
                        </div>
                        <p class="toy-label">Lofi Tape</p>
                    </div>

                    <!-- Mixer Widget -->
                    <div id="widget-mixer" class="widget-content">
                        <div class="mixer-container">
                            <div class="mixer-row"><i class="fas fa-cloud-rain"></i><input type="range" class="mixer-slider" min="0" max="100" value="0"></div>
                            <div class="mixer-row"><i class="fas fa-wind"></i><input type="range" class="mixer-slider" min="0" max="100" value="0"></div>
                            <div class="mixer-row"><i class="fas fa-mug-hot"></i><input type="range" class="mixer-slider" min="0" max="100" value="0"></div>
                            <div class="mixer-row"><i class="fas fa-fire"></i><input type="range" class="mixer-slider" min="0" max="100" value="0"></div>
                        </div>
                        <p class="toy-label">Zen Mixer</p>
                    </div>

                    <!-- Stars Widget -->
                    <div id="widget-stars" class="widget-content">
                        <div class="stars-container" id="stars-display"></div>
                        <p class="toy-label">Focus Stars</p>
                    </div>

                    <!-- Pet Widget -->
                    <div id="widget-pet" class="widget-content">
                        <div class="pet-container">
                            <div class="pet-character" id="pet-display"><i class="fas fa-robot"></i></div>
                            <p id="pet-status">Pet is resting...</p>
                        </div>
                        <p class="toy-label">Focus Pet</p>
                    </div>

                    <!-- Pulse Widget -->
                    <div id="widget-pulse" class="widget-content">
                        <div class="pulse-container"><div class="pulse-blob"></div></div>
                        <p class="toy-label">Focus Pulse</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Widget: Focus Timer (Center) -->
        <div class="glass-panel timer-panel">
            <!-- Task Selection -->
            <div class="task-selector">
                <select id="focus-task-select">
                    <option value="">-- Select a Task --</option>
                    <option value="Just Focus">Just Focus</option>
                </select>
            </div>

            <div class="timer-display">
                <!-- Circular progress with dynamic colors and moving thumb -->
                <svg class="progress-ring" width="300" height="300">
                    <circle class="progress-ring__circle-bg" stroke="var(--accent)" stroke-width="10" fill="transparent" r="140" cx="150" cy="150"/>
                    <circle class="progress-ring__circle" stroke="rgba(0,0,0,0.5)" stroke-width="10" fill="transparent" r="140" cx="150" cy="150"/>
                    <circle class="progress-ring__thumb" r="6" fill="white" cx="150" cy="10" />
                </svg>
                <div class="time-container">
                    <div class="time" id="time" contenteditable="true" title="Click to edit minutes">25:00</div>
                    <div class="edit-hint">edit</div>
                </div>
            </div>

            <div class="controls">
                <button id="toggle-sound" class="icon-btn" title="Toggle Brown Noise"><i class="fas fa-volume-mute"></i></button>
                <button id="start-btn" class="main-btn"><i class="fas fa-play"></i></button>
                <button id="reset-btn" class="icon-btn"><i class="fas fa-redo"></i></button>
            </div>
            <div class="status" id="timer-status">Ready to Focus</div>
        </div>

        <!-- Widget: To-Do List (Right) -->
        <div class="glass-panel todo-panel">
            <h3>Today's Tasks</h3>
            <div class="todo-input-group">
                <input type="text" id="todo-input" placeholder="Add a new task...">
                <button id="add-todo"><i class="fas fa-plus"></i></button>
            </div>
            <ul id="todo-list" class="todo-list">
                <!-- Items added here -->
            </ul>
        </div>
    </main>

    <!-- Widget: Quote (Bottom) -->
    <div class="quote-container">
        <p id="quote-text">"Loading inspiration..."</p>
        <span id="quote-author"></span>
        <button id="new-quote" title="New Quote"><i class="fas fa-sync-alt"></i></button>
    </div>

    <!-- Settings Button -->
    <button id="settings-btn" class="settings-toggle" title="Customize Theme"><i class="fas fa-cog"></i></button>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content glass-panel">
            <div class="modal-header">
                <h3>Settings</h3>
                <button id="close-settings"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="settings-group">
                <h4>Personalize</h4>
                <div class="input-row">
                    <label>Name:</label>
                    <input type="text" id="user-name" placeholder="Your Name">
                </div>
                <div class="input-row">
                    <label>City:</label>
                    <div class="geo-group">
                        <input type="text" id="user-city" placeholder="City Name">
                        <button id="geo-btn" title="Auto-Detect Location"><i class="fas fa-location-arrow"></i></button>
                    </div>
                </div>
                <div class="input-row hidden" id="manual-coords">
                     <label>Coords:</label>
                     <input type="text" id="user-lat" placeholder="Lat">
                     <input type="text" id="user-lon" placeholder="Lon">
                </div>
            </div>

            <div class="wallpaper-section">
                <h4>Aesthetic (2D)</h4>
                <div class="presets">
                    <!-- Anime / 2D Presets -->
                    <button class="preset-btn" data-bg="https://images.wallpapersden.com/image/download/anime-girl-looking-at-sky-scenery_bWlma2uUmZqaraWkpJRmbmdlrWZlbWU.jpg" style="background-image: url('https://images.wallpapersden.com/image/download/anime-girl-looking-at-sky-scenery_bWlma2uUmZqaraWkpJRmbmdlrWZlbWU.jpg')"></button>
                    <button class="preset-btn" data-bg="https://c4.wallpaperflare.com/wallpaper/500/442/354/outrun-vaporwave-hd-wallpaper-preview.jpg" style="background-image: url('https://c4.wallpaperflare.com/wallpaper/500/442/354/outrun-vaporwave-hd-wallpaper-preview.jpg')"></button>
                    <button class="preset-btn" data-bg="https://images.wallpapersden.com/image/download/pixel-art-night-sky-scenery_bWxlZm6UmZqaraWkpJRmbmdlrWZlbWU.jpg" style="background-image: url('https://images.wallpapersden.com/image/download/pixel-art-night-sky-scenery_bWxlZm6UmZqaraWkpJRmbmdlrWZlbWU.jpg')"></button>
                    <button class="preset-btn" data-bg="https://images.wallpapersden.com/image/download/lofi-girl-original_bGZraWyUmZqaraWkpJRmbmdlrWZlbWU.jpg" style="background-image: url('https://images.wallpapersden.com/image/download/lofi-girl-original_bGZraWyUmZqaraWkpJRmbmdlrWZlbWU.jpg')"></button>
                </div>
            </div>

            <div class="upload-section">
                <h4>Custom Wallpaper</h4>
                <label for="bg-upload" class="upload-btn">
                    <i class="fas fa-upload"></i> Upload Image
                </label>
                <input type="file" id="bg-upload" accept="image/*" hidden>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>